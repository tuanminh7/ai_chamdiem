{% extends "layout.html" %}
{% block title %}Gá»­i bÃ i lÃ m{% endblock %}

{% block content %}
<h2>ğŸ“¤ Gá»­i bÃ i lÃ m</h2>

<form method="POST" enctype="multipart/form-data" style="margin-bottom: 30px;">
  <label for="group_name">TÃªn nhÃ³m:</label><br>
  <input type="text" name="group_name" placeholder="Nháº­p tÃªn nhÃ³m" required><br><br>

  <label for="image">Chá»n file (.png, .jpg, .jpeg, .pdf):</label><br>
  <input type="file" name="image" accept=".png,.jpg,.jpeg,.pdf" required><br><br>

  <button type="submit">ğŸ“¤ Gá»­i bÃ i</button>
</form>

{% if feedback %}
  <div style="margin-top: 30px; background-color: #e0f2f1; padding: 20px; border-left: 5px solid #009688; border-radius: 8px;">
    <h3>ğŸ¤– Pháº£n há»“i tá»« AI:</h3>
    <p>{{ feedback }}</p>
  </div>
{% endif %}

{% if score %}
  <div style="margin-top: 20px; background-color: #fff3e0; padding: 20px; border-left: 5px solid #ff9800; border-radius: 8px;">
    <h3>ğŸ“Š ÄÃ¡nh giÃ¡ Ä‘iá»ƒm:</h3>
    <p>{{ score }}</p>
  </div>
{% endif %}

<hr>
<h2>ğŸ“š CÃ¡c bÃ i lÃ m Ä‘Ã£ gá»­i</h2>

{% for img in images %}
  <div style="border: 1px solid #ccc; padding: 15px; margin-bottom: 30px; border-radius: 8px;">
    <h3>ğŸ‘¥ NhÃ³m: {{ img.group_name }}</h3>

    {% if img.file_type == 'pdf' %}
      <p>ğŸ“„ <a href="{{ url_for('static', filename='uploads/' + img.filename) }}" target="_blank">Xem file PDF</a></p>
    {% else %}
      <img src="{{ url_for('static', filename='uploads/' + img.filename) }}" style="max-width: 300px; border-radius: 5px;">
    {% endif %}

    <p><strong>ğŸ¤– Nháº­n xÃ©t cá»§a AI:</strong><br>{{ img.ai_feedback }}</p>

    {% if img.score_feedback %}
      <p><strong>ğŸ“Š ÄÃ¡nh giÃ¡ Ä‘iá»ƒm (AI):</strong><br>{{ img.score_feedback }}</p>
    {% endif %}

    <p><strong>ğŸ“Š Äiá»ƒm trung bÃ¬nh hiá»‡n táº¡i:</strong>
       {{ img.average_score if img.average_score else "ChÆ°a cÃ³" }}
    </p>

    <form action="{{ url_for('comment', project_id='general', image_id=img.id) }}" method="POST" style="margin-top: 20px;">
      <label for="student_name">TÃªn cá»§a báº¡n:</label><br>
      <input type="text" name="student_name" placeholder="Nháº­p tÃªn" required><br><br>

      <label for="comment_text">Nháº­n xÃ©t bÃ i lÃ m:</label><br>
      <textarea name="comment_text" placeholder="Viáº¿t nháº­n xÃ©t..." required style="width:100%; height:60px;"></textarea><br><br>

      <label for="score">Cháº¥m Ä‘iá»ƒm (0â€“10):</label><br>
      <input type="number" name="score" placeholder="Nháº­p Ä‘iá»ƒm" min="0" max="10" step="0.1" required><br><br>

      <button type="submit">ğŸ’¬ Gá»­i nháº­n xÃ©t & Ä‘iá»ƒm</button>
    </form>

    {% if img.comments %}
      <h4 style="margin-top: 20px;">ğŸ’¬ BÃ¬nh luáº­n & Äiá»ƒm:</h4>
      <div style="margin-left: 10px;">
        {% for cmt in img.comments %}
          <p><strong>{{ cmt.student_name }}:</strong> {{ cmt.comment_text }}
             {% if cmt.score is defined %}(Äiá»ƒm: {{ cmt.score }}){% endif %}
          </p>
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endfor %}

<div style="margin-top: 30px;">
  <a href="{{ url_for('projects') }}">â¬…ï¸ Quay vá» danh sÃ¡ch Ä‘á» bÃ i</a>
</div>
{% endblock %}
