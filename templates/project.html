{% extends "layout.html" %}
{% block title %}{{ project.title }}{% endblock %}
{% block content %}
<h2> {{ project.title }}</h2>
<p>{{ project.description }}</p>

{% if feedback %}
  <div class="feedback"><strong>{{ feedback }}</strong></div>
{% endif %}

<h3> Gá»­i bÃ i lÃ m</h3>
<form method="POST" enctype="multipart/form-data">
  <input type="text" name="group_name" placeholder="TÃªn nhÃ³m" required>
  <input type="file" name="image" accept=".png,.jpg,.jpeg,.pdf" required>
  <textarea name="note" placeholder="Ghi chÃº vá» bÃ i lÃ m (náº¿u cÃ³)" rows="4" style="width:100%; margin-top:10px;"></textarea>
  <button type="submit">Gá»­i bÃ i</button>
</form>

<hr>
<h3> BÃ i lÃ m Ä‘Ã£ gá»­i</h3>
{% for img in images %}
  <div style="margin-bottom: 30px;">
    <p><strong>NhÃ³m:</strong> {{ img.group_name }}</p>
    {% if img.note %}
      <p><strong>Ghi chÃº:</strong> {{ img.note }}</p>
    {% endif %}

    {% if img.file_type == 'pdf' %}
      <p> <a href="{{ url_for('static', filename='uploads/' ~ img.filename) }}" target="_blank">Xem file PDF</a></p>
    {% else %}
      <img src="{{ url_for('static', filename='uploads/' ~ img.filename) }}" width="300"><br><br>
    {% endif %}

    <p><strong>Pháº£n há»“i AI:</strong><br>{{ img.ai_feedback }}</p>

    {% if img.score_feedback %}
      <p><strong> ÄÃ¡nh giÃ¡ Ä‘iá»ƒm:</strong><br>{{ img.score_feedback }}</p>
    {% endif %}

    <h4>ğŸ’¬ BÃ¬nh luáº­n & Cháº¥m Ä‘iá»ƒm</h4>
    <form method="POST" action="{{ url_for('comment', project_id=project.id, image_id=img.id) }}">
      <input type="text" name="student_name" placeholder="TÃªn há»c sinh" required>
      <input type="text" name="comment_text" placeholder="BÃ¬nh luáº­n" required>
      <input type="number" name="score" placeholder="Äiá»ƒm (0-10)" min="0" max="10" step="0.1" required>
      <button type="submit">Gá»­i</button>
    </form>

    <p><strong>ğŸ“Š Äiá»ƒm trung bÃ¬nh:</strong> 
       {{ img.average_score if img.average_score else "ChÆ°a cÃ³" }}
    </p>

    <ul>
      {% for cmt in img.comments %}
        <li>
          <strong>{{ cmt.student_name }}:</strong> {{ cmt.comment_text }}
          {% if cmt.score is defined %} (Äiá»ƒm: {{ cmt.score }}){% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
  <hr>
{% endfor %}
<a href="/projects">â¬…ï¸ Quay láº¡i danh sÃ¡ch Ä‘á» bÃ i</a>
{% endblock %}
